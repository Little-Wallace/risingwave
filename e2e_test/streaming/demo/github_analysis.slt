statement ok
CREATE TABLE github (
    repository_id VARCHAR,
    star_count BIGINT,
    create_at TIMESTAMP
);

statement ok
insert into github values
('CS1001',37,'2013-06-08 09:37:54'),
('CS1002',39,'2013-06-08 09:37:54'),
('CS1003',52,'2013-06-08 09:37:54'),
('CS1004',99,'2013-06-08 09:37:54');

statement ok
CREATE MATERIALIZED VIEW time_view as
SELECT repository_id, star_count, window_start
FROM tumble(github, create_at, interval '10' minute);

statement ok
insert into github values
('CS1001',57,'2013-06-08 09:47:54'),
('CS1002',69,'2013-06-08 09:47:54'),
('CS1003',82,'2013-06-08 09:47:54'),
('CS1004',139,'2013-06-08 09:47:54');

statement ok
CREATE MATERIALIZED VIEW diff_view as
select t2.star_count - t1.star_count as diff, t2.repository_id, t2.window_start
from time_view as t1 cross join time_view as
t2 where t1.window_start = t2.window_start - Interval '10' minute and t1.repository_id = t2.repository_id;

statement ok
CREATE MATERIALIZED VIEW topK_star_increment_view as
select * from diff_view
where window_start = (select max(window_start) from diff_view)
order by diff desc;

statement ok
CREATE MATERIALIZED VIEW topK_star_count_view as
select * from time_view
where window_start = (select max(window_start) from time_view)
order by star_count desc;

statement ok
insert into github values
('CS1001',113,'2013-06-08 09:58:03'),
('CS1002',129,'2013-06-08 09:58:04'),
('CS1003',132,'2013-06-08 09:58:05'),
('CS1004',169,'2013-06-08 09:58:06');



